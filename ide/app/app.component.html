<div class="mdl-layout mdl-js-layout mdl-layout--no-drawer-button">
  <header class="mdl-layout__header mdl-layout__header--scroll">
    <div class="mdl-layout__header-row">
      <!-- Title -->
      <span class="mdl-layout-title">Plomino IDE</span>
      <!-- Add spacer, to align navigation to the right -->
      <div class="mdl-layout-spacer"></div>
      <!-- Navigation. We hide it in small screens. -->
      <nav class="mdl-navigation mdl-layout--large-screen-only">
        <!--<a class="mdl-navigation__link" href (click)="addNewForm($event)">Add New Form</a>-->
        <a class="mdl-navigation__link" [href]="getPloneLink()">Close IDE</a>
        <a class="mdl-navigation__link" href="/Plone/logout">Logout</a>
      </nav>
    </div>
  </header>
  <div class="mdl-layout__drawer">
    <!--<span class="mdl-layout-title">Title</span>
    <nav class="mdl-navigation">
      <a class="mdl-navigation__link" href="">Link</a>
      <a class="mdl-navigation__link" href="">Link</a>
      <a class="mdl-navigation__link" href="">Link</a>
      <a class="mdl-navigation__link" href="">Link</a>
    </nav>-->
  </div>
  <main class="mdl-layout__content">
    <div class="page-content">
      <plomino-block-preloader [loading]="false"></plomino-block-preloader>
      
      <div class="wrap-app">
  
        <div class="well sidebar mdl-color--grey-50">

          <div class="palette-wrapper">
            <plomino-palette>
            </plomino-palette>
          </div>
          
          <div class="tree-wrapper">
            <plomino-resize-divider [listen]="[DIRECTION_DOWN, DIRECTION_UP]"
              (move)="resizeTree($event)"></plomino-resize-divider>
            <div class="content">
              <plomino-tree [data]="data" 
                            [selected]="selected" 
                            (add)="onAdd($event)" 
                            (openTab)="openTab($event)">
              </plomino-tree>
            </div>
          </div>
        </div>

        <plomino-resize-divider
          [listen]="[DIRECTION_LEFT, DIRECTION_RIGHT]"
          [columnResize]="true"
          (move)="resizeColumns($event)"></plomino-resize-divider>
        
        <div class="main-app panel">
          <div class="drop-zone-container"
            @dropZoneState="isDragging && 
                  dragData !== null &&
                  (dragData['@type'] === 'PlominoForm' || 
                    dragData['@type'] === 'PlominoView')"
                    
            *ngIf="isDragging && 
                  dragData !== null &&
                  (dragData['@type'] === 'PlominoForm' || 
                    dragData['@type'] === 'PlominoView')"
            dnd-droppable
            [allowDrop]="allowDrop()"
            (onDropSuccess)="dropped()">
            <div class="drop-zone-label">
              <p class="glyphicon glyphicon-download" 
                  aria-hidden="true">
              </p>
              <p class="heading">
                Drop Selected Item here
              </p>
            </div>
          </div>
          
          <tabset>
            <tab *ngFor="let tabz of tabs" 
                [heading]="" 
                [removable]="true" 
                [active]="tabz.active"
                (removed)="closeTab(tabz)"
                (select)="onTabSelect(tabz)">
              
              <template tabHeading>
                  <span class="tab-trigger" [class.tabunsaved]="tabz.isdirty"
                    [attr.data-editor]="tabz.editor"
                    [attr.data-url]="tabz.url" [attr.data-active]="tabz.active">
                    <loading *ngIf="tabz.isloading"></loading>
                    <span *ngIf="tabz.isdirty">* </span>
                    <span *ngIf="tabz.editor !== 'workflow'" class="tab-type-image">
                      <img [src]="getTabTypeImage(tabz.editor)">
                    </span>
                    <i style="position: relative; top: 4px;" 
                      *ngIf="tabz.editor === 'workflow'"
                      class="material-icons">work</i>
                    <span class="tab-name">{{tabz.url | extractName}}</span>
                  </span>
              </template>
              
              <plomino-tiny-mce *ngIf="tabz.editor==='layout'" 
                  [id]="tabz.url"
                  [item]="tabz"
                  (isLoading)="tabz.isloading=$event"
                  (isDirty)="setTabzAsDirty(tabz, $event)"
                  (fieldSelected)="fieldSelected($event)">
              </plomino-tiny-mce>

              <plomino-workflow-editor *ngIf="tabz.editor==='workflow'" 
                  [id]="tabz.url"
                  [item]="tabz">
              </plomino-workflow-editor>

              <plomino-view-editor *ngIf="tabz.editor==='view'" 
                  [id]="tabz.url"
                  [item]="tabz"
                  (isLoading)="tabz.isloading=$event">
              </plomino-view-editor>
              
              <plomino-ace-editor *ngIf="tabz.editor==='code'" 
                  [url]="tabz.url" 
                  [path]="tabz.path" 
                  [aceNumber]="aceNumber" 
                  (isDirty)="tabz.isdirty=$event">
              </plomino-ace-editor>
              
              <plomino-forms-settings *ngIf="tabz.editor === 'settings' && 
                                            tabz.path[0].type === 'Forms' && 
                                            tabz.path.length < 2" 
                  [id]='tabz.url' 
                  (elementDeleted)='tabs.splice(tabs.indexOf(tabz),1); getTree()' 
                  (titleChanged)='tabz.title=$event; getTree()'
                  (isDirty)="tabz.isdirty=$event">
              </plomino-forms-settings>
              
              <plomino-fields-settings *ngIf="tabz.editor === 'settings' && 
                                              tabz.path[0].type === 'Forms' && 
                                              tabz.path[1]?.type === 'Fields'" 
                  [id]='tabz.url' 
                  [tree]="data" 
                  (elementDeleted)='tabs.splice(tabs.indexOf(tabz),1); getTree()' 
                  (titleChanged)='tabz.title=$event; getTree()'
                  (isDirty)="tabz.isdirty=$event">
              </plomino-fields-settings>
              
              <plomino-actions-settings *ngIf="tabz.editor === 'settings' && 
                                              tabz.path[1]?.type === 'Actions'" 
                    [id]='tabz.url' 
                    (elementDeleted)='tabs.splice(tabs.indexOf(tabz),1); getTree()' 
                    (titleChanged)='tabz.title=$event; getTree()' 
                    (isDirty)="tabz.isdirty=$event">
              </plomino-actions-settings>
              
              <plomino-hide-when-settings *ngIf="tabz.editor === 'settings' && 
                                                tabz.path[1]?.type === 'Hide Whens'" 
                    [id]='tabz.url' 
                    (elementDeleted)='tabs.splice(tabs.indexOf(tabz),1); getTree()' 
                    (titleChanged)='tabz.title=$event; getTree()' 
                    (isDirty)="tabz.isdirty=$event">
              </plomino-hide-when-settings>
              
              <plomino-views-settings *ngIf="tabz.editor === 'settings' && 
                                            tabz.path[0].type === 'Views' && 
                                            tabz.path.length < 2" 
                    [id]='tabz.url' 
                    (elementDeleted)='tabs.splice(tabs.indexOf(tabz),1); getTree()' 
                    (titleChanged)='tabz.title=$event; getTree()'
                    (isDirty)="tabz.isdirty=$event">
              </plomino-views-settings>
              
              <plomino-columns-settings *ngIf="tabz.editor === 'settings' && 
                                              tabz.path[1]?.type === 'Columns'" 
                    [id]='tabz.url' 
                    (elementDeleted)='tabs.splice(tabs.indexOf(tabz),1); getTree()' 
                    (titleChanged)='tabz.title=$event; getTree()' 
                    (isDirty)="tabz.isdirty=$event">
              </plomino-columns-settings>
              
              <plomino-agents-settings *ngIf="tabz.editor === 'settings' && 
                                              tabz.path[0].type === 'Agents'" 
                    [id]='tabz.url' 
                    (elementDeleted)='tabs.splice(tabs.indexOf(tabz),1); getTree()' 
                    (titleChanged)='tabz.title=$event; getTree()'
                    (isDirty)="tabz.isdirty=$event">
              </plomino-agents-settings>
            </tab>
          </tabset>
        </div>
        <modal *ngIf="isModalOpen" [data]="modalData" (modalClosed)="onModalClose($event)" (modalDismissed)="isModalOpen = false"></modal>
      </div>

    </div>
  </main>
</div>
