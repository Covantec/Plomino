require(["jquery","pat-base","mockup-patterns-texteditor"],function(e,r,t){"use strict";return r.extend({name:"plominoformula",parser:"mockup",trigger:".plomino-formula",defaults:{},init:function(){var r=this;r.$el.width();r.$el.hide();var i=e("<pre></pre>");i.appendTo(r.$el.parent()),r.ace=new t(i),r.ace.init(),setTimeout(function(){r.ace.editor.getSession().setMode("ace/mode/python"),i.css("width","100%"),r.ace.editor.resize(),r.ace.setText(r.$el.val()),r.ace.editor.on("change",function(){r.$el.val(r.ace.editor.getValue())})},200)}})}),define("/Users/ivan/code/work/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/formula.js",function(){}),require(["jquery","pat-base"],function(e,r){"use strict";return r.extend({name:"plominotable",parser:"mockup",trigger:".plomino-table",defaults:{},init:function(){var e=this;e.init_search(),e.init_sorting(),e.refresh({}),e.params={}},refresh:function(){var r=this;if(r.options.source){r.$el.find("tr:not(.header-row)").remove();var t=r.$el.find("tr.header-row.count");t.find("td").text("Loading..."),e.get(r.options.source,r.params,function(e){for(var i="",n=0;n<e.rows.length;n++){var o=e.rows[n];if(i+="<tr>",i+="<td>","True"!==r.options.hideCheckboxes&&(i+='<input type="checkbox" name="sdoc" value="'+o[0]+'" />'),i+="</td>",i+='<td><a href="'+r.options.source+"/../document/"+o[0]+'">'+o[1]+"</a></td>",o.length>2)for(var a=2;a<o.length;a++)i+="<td>"+o[a]+"</td>";i+="</tr>"}e.rows.length>1?t.find("td").text(e.rows.length+" documents"):t.find("td").text(e.rows.length+" document"),t.before(i)})}},init_search:function(){var r=this,t=e('<input type="text" placeholder="Search"/>');r.$el.before(t),t.on("submit",function(){return!1});var i,n=!1;t.on("keyup",function(){var t=e('#plomino-view input[type="text"]').val();t.length<3&&!n||(i&&clearTimeout(i),i=setTimeout(function(){r.params.search=t,r.refresh(),n=!!t,clearTimeout(i)},1e3))})},init_sorting:function(){var r=this;r.$el.find("th").on("click",function(){r.$el.find("th").removeClass("icon-down-dir icon-up-dir");var t=e(this).attr("data-column");t==r.params.sorton?r.params.reverse=1==r.params.reverse?0:1:(r.params.sorton=t,r.params.reverse=0),0===r.params.reverse?e(this).addClass("icon-down-dir"):e(this).addClass("icon-up-dir"),r.refresh()})}})}),define("/Users/ivan/code/work/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/table.js",function(){}),require(["jquery","pat-base"],function(e,r){"use strict";return r.extend({name:"plominodynamic",parser:"mockup",trigger:"#plomino_form",defaults:{},init:function(){var r=this;r.refresh(this.$el),this.$el.find(":input").change(function(e){r.refresh(e.target)}),r.hidewhen_html={},r.$el.find(".plomino-hidewhen").each(function(t,i){r.hidewhen_html[e(i).attr("data-hidewhen")]=e(i).html()})},refresh:function(r){var t=this,i=t.getCurrentInputs();t.options.docid&&(i._docid=t.options.docid),i._hidewhens=t.getHidewhens(),i._fields=t.getDynamicFields(),i._validation=r.id,(i._hidewhens.length>0||i._fields.length>0)&&e.post(t.options.url+"/dynamic_evaluation",e.param(i,!0),function(e){t.applyHidewhens(e.hidewhens),t.applyDynamicFields(e.fields)},"json")},getCurrentInputs:function(){var r,t,i,n,o,a,s={},l=e("form").serialize().split("&");for(r in l)i=(t=l[r].split("="))[0],n=decodeURIComponent(t[1].replace(/\+/g,"%20")),i in s&&(o=s[i],a=[],Array.isArray(o)||(a.push(o),o=a),o.push(n),n=o),s[i]=n;return s},getHidewhens:function(){var r=[];return this.$el.find(".plomino-hidewhen").each(function(t,i){r.push(e(i).attr("data-hidewhen"))}),r},getDynamicFields:function(){var r=[];return this.$el.find(".dynamicfield").each(function(t,i){r.push(e(i).attr("data-dynamicfield"))}),r},applyHidewhens:function(e){for(var r=this,t=0;t<e.length;t++){var i=e[t][0],n=e[t][1],o=e[t][2],a=r.$el.find('.plomino-hidewhen[data-hidewhen="'+i+'"]');n?(a.hide(),o&&(a.html(r.hidewhen_html[i]),a.find(":input").change(function(e){r.refresh(e.target)}))):a.show()}},applyDynamicFields:function(e){for(var r=this,t=0;t<e.length;t++){var i=e[t][0],n=e[t][1];r.$el.find('.dynamicfield[data-dynamicfield="'+i+'"]').text(n)}}})}),define("/Users/ivan/code/work/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/dynamic.js",function(){}),require(["jquery","pat-base","mockup-patterns-modal","mockup-patterns-select2"],function(e,r,t,i){"use strict";return r.extend({name:"plominodatagrid",parser:"mockup",trigger:".plomino-datagrid",defaults:{},init:function(){var e=this;if(e.fields=e.$el.attr("data-fields").split(","),e.columns=e.$el.attr("data-columns").split(","),e.input=e.$el.find('input[type="hidden"]'),e.values=JSON.parse(e.input.val()),e.rows=JSON.parse(e.$el.find("table").attr("data-rows")),e.col_number=e.fields.length,e.associated_form=e.$el.attr("data-associated-form"),e.$el.attr("data-form-urls"))e.form_urls=JSON.parse(e.$el.attr("data-form-urls"));else{var r=/(.*)\/(.*)\/OpenForm\?(.*)/.exec(e.$el.attr("data-form-url"))[2];e.form_urls=[{url:e.$el.attr("data-form-url"),id:r}]}e.render()},setValue:function(e){var r=this;r.input.val(e),r.input.change()},render:function(){for(var r=this,i=r.$el.find("table"),n="<tr><th></th>",o=0;o<r.col_number;o++)n+="<th>"+r.columns[o]+"</th>";n+="</tr>";for(var a=0;a<r.rows.length;a++){for(var s=r.form_url,l=r.associated_form,d=0;d<r.form_urls.length;d++)if(r.form_urls[d].id==l){s=r.form_urls[d].url;break}n+='<tr><td class="actions"><a class="edit-row" href="'+(s+="&"+e.param(r.values[a]))+'" data-formid="'+l+'"><i class="icon-pencil"></i></a>',n+='<a class="remove-row" href="#"><i class="icon-cancel"></i></a>',n+='<a class="up-row" href="#"><i class="icon-up-dir"></i></a>',n+='<a class="down-row" href="#"><i class="icon-down-dir"></i></a></td>';for(o=0;o<r.col_number;o++)n+="<td>"+(r.rows[a][o]?r.rows[a][o]:"")+"</td>";n+="</tr>"}var c="";if(r.form_urls.length>1){for(c='<select class="form_select" data-pat="width:10em">',o=0;o<r.form_urls.length;o++){var u=r.form_urls[o];c+='<option value="'+u.url+'">'+u.title+"</option>"}c+="</select>"}void 0!=r.form_urls[0]&&(n+='<tr><td class="actions" colspan="5">'+c+'<a class="add-row" href="'+r.form_urls[0].url+'" data-formid="'+r.form_urls[0].id+'"><i class="icon-plus"></i></a></td></tr>'),i.html(n);var f=r.$el.find(".add-row");r.$el.find(".form_select").each(function(t,i){var n;e(i).change(function(){for(var t=e(i).val(),o=0;o<r.form_urls.length;o++)if(r.form_urls[o].url==t){n=r.form_urls[o].id;break}f.attr("href",t).attr("data-formid",n)})});var p=t.extend({render:function(r){var t=this;t.emit("render"),t.options.render.apply(t,[r]),t.emit("rendered"),e(".plominoClose").attr("onclick",'$(".plone-modal-close").click()')}});f.click(function(e){e.stopPropagation(),e.preventDefault();var t=r.$el.find(".add-row i");!function(e){new p(t,{ajaxUrl:f.attr("href"),ajaxType:"POST",position:"middle top",actions:{"input.plominoSave":{onSuccess:r.add.bind({grid:r,formid:f.attr("data-formid")}),onError:function(){return e.alert(response.responseJSON.errors.join("\n")),!1}}}}).show()}(window.top)}),r.$el.find(".edit-row").each(function(t,i){var n=e(i).attr("href").split("?",2);e(i).on("click",function(o){o.preventDefault(),jQuery.ajax({url:n[0],type:"POST",data:n[1]}).done(function(n){new p(r.$el,{html:n,position:"middle top",actions:{"input.plominoSave":{onSuccess:r.edit.bind({grid:r,row:t,formid:e(i).attr("data-formid")}),onError:function(){return window.alert(response.responseJSON.errors.join("\n")),!1}}}}).show()})})}),r.$el.find(".remove-row").each(function(t,i){e(i).click(function(){r.remove(r,t)})}),r.$el.find(".up-row").each(function(t,i){e(i).click(function(){r.up(r,t)})}),r.$el.find(".down-row").each(function(t,i){e(i).click(function(){r.down(r,t)})})},add:function(e,r,t,i,n){var o=this.grid,a=this.formid;if(!r.errors){e.hide();for(var s={},l=[],d=(n.serializeArray(),0);d<o.col_number;d++)void 0!=o.fields[d]&&o.fields[d]in r?l.push(r[o.fields[d]].rendered):l.push("");for(var c in r)s[c]=r[c].raw;s.Form=a,o.values.push(s),o.setValue(JSON.stringify(o.values)),o.rows.push(l),o.render()}return!1},edit:function(e,r,t,i,n){var o=this.grid,a=this.row,s=this.formid;if(!r.errors){e.hide();for(var l=[],d=0;d<o.col_number;d++)void 0!=o.fields[d]&&o.fields[d]in r?l.push(r[o.fields[d]].rendered):l.push("");o.values[a].Form=s;for(var c in r)o.values[a][c]=r[c].raw;o.setValue(JSON.stringify(o.values)),o.rows[a]=l,o.render()}return!1},remove:function(e,r){return e.values.splice(r,1),e.setValue(JSON.stringify(e.values)),e.rows.splice(r,1),e.render(),!1},up:function(e,r){if(0!=r)return e.values.splice(r-1,0,e.values.splice(r,1)[0]),e.setValue(JSON.stringify(e.values)),e.rows.splice(r-1,0,e.rows.splice(r,1)[0]),e.render(),!1},down:function(e,r){if(r!=e.values.length-1)return e.values.splice(r,0,e.values.splice(r+1,1)[0]),e.setValue(JSON.stringify(e.values)),e.rows.splice(r,0,e.rows.splice(r+1,1)[0]),e.render(),!1}})}),define("/Users/ivan/code/work/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/datagrid.js",function(){}),require(["jquery","pat-base"],function(e,r){"use strict";return r.extend({name:"plominomultipage",parser:"mockup",trigger:'body.template-page.portaltype-plominoform #plomino_form input[name="plomino_current_page"]',defaults:{},init:function(){var e=this.$el.parents("#plomino_form").attr("action"),r={multipage:"multipage"};history.pushState(r,"",e)}})}),define("/Users/ivan/code/work/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/multipage.js",function(){}),require(["jquery","pat-base","mockup-patterns-modal","mockup-patterns-select2","mockup-patterns-sortable","mockup-patterns-backdrop","mockup-utils","pat-registry"],function(e,r,t,i,n,o,a,s){"use strict";return r.extend({name:"plominomacros",parser:"mockup",trigger:".plomino-macros",defaults:{},init:function(){var e=this;e.form_urls=JSON.parse(e.$el.attr("data-form-urls"));var r=[];for(var t in e.form_urls)r.push({text:t,children:e.form_urls[t].map(function(e){if(void 0!=e.title)return{id:e.id,text:e.title}})});e.select2_args={data:r,separator:"\t",multiple:!0,allowNewItems:!1,placeholder:"add a new rule",formatSelection:e.formatMacro};e.item=e.$el.find("li").last()[0].outerHTML,e.$el.prepend(""),e.ids={};var i=0;e.$el.find("input").each(function(r,t){var n=[];""!=t.value&&(n=t.value.split("\t")),void 0==n.map&&(n=[n]),n=n.map(function(r){if(""!=r){var t=JSON.parse(r);return t._macro_id_&&(e.ids[t._macro_id_]=!0),{id:r,text:""}}}),e.initInput.bind({widget:e})(t,n),i++}),e.cleanup_inputs.bind({widget:e})(),e.backdrop=new o(e.$el,{closeOnEsc:!0,closeOnClick:!1}),e.loading=a.Loading({backdrop:e.backdrop})},initInput:function(r,t){var n=this.widget;new i(e(r),n.select2_args);var o=e(r);o.select2("data",t),o.change(function(r){var t=e(r.target);if(void 0!=r.added){var i=r.added.id,o=r.added.text,a=t.select2("data");a.pop(),t.select2("data",a),n.edit_macro.bind({widget:n})(t,i,o,{},a.length)}else if(void 0!=r.removed){r.removed.id;n.cleanup_inputs.bind({widget:n})()}return!1})},cleanup_inputs:function(){var r=this.widget,t=r.$el.find(".select2-container").size();r.$el.find(".select2-container").each(function(i,o){var a=e(o),s=a.select2("data");0==s.length&&i<t-1?e(o).closest("li").remove():(e(o).find(".select2-search-choice").each(function(t,i){e(i).on("click",function(e){e.preventDefault();var i=s[t],n=JSON.parse(i.id),o=n.Form;r.edit_macro.bind({widget:r})(a,o,n.title,n,t)})}),new n(e(o).find(".select2-choices"),{selector:".select2-search-choice",drop:function(){e(o).select2("onSortEnd")}})),i==t-1&&s.length>0&&e(r.item).appendTo(r.$el).find("input").each(function(t,i){r.initInput.bind({widget:r})(e(i),[])})}),new n(r.$el,{selector:".plomino-macros-rule"})},formatMacro:function(e){if(e.text)return e.text;var r=(e=JSON.parse(e.id)).Form;if("or"==r||"and"==r||"nor"==r)return e.title;var t="do";return r.startsWith("macro_condition_")&&(t="if"),'<span class="plomino_edit_macro"><i>'+t+"</i>&nbsp;"+e.title+'<i class="icon-pencil"></i></span>'},edit_macro:function(r,i,n,o,a){var s=this.widget,l=null;for(var d in s.form_urls)s.form_urls[d].map(function(e){e.id==i&&(l=e.url)});c=o._macro_id_;if("#"!=l[0]||!s.ids[c])if(null!=l){for(var c=o._macro_id_,u=1;void 0==c||s.ids[c];)c=i+"_"+u,u++;if(o._macro_id_=c,s.ids[c]=!0,l.startsWith("#")){var f=r.select2("data");return o.title=n,o.Form=i,f.push({id:JSON.stringify(o),text:n}),r.select2("data",f),void s.cleanup_inputs.bind({widget:s})()}s.backdrop.show(),s.loading.show(!0),jQuery.ajax({url:l,type:"POST",traditional:!0,data:o}).done(function(o){s.loading.hide(),s.backdrop.hide();new t(s.$el,{html:o,position:"middle top",actions:{"input.plominoSave":{onSuccess:function(t,o,l,d,c){if(e(o).find("#validation_errors").length>0)return!1;if(o.errors)return!1;t.hide();var u=r.select2("data"),f={};return e.map(o,function(e,r){f[r]=e.raw}),f.Form=i,void 0==f.title&&(f.title=n),u[a]={id:JSON.stringify(f),text:""},r.select2("data",u),s.cleanup_inputs.bind({widget:s})(),!1},onError:function(){return window.alert(response.responseJSON.errors.join("\n")),!1}}}}).show()})}else new t(e(r),{title:"Macro not found",html:"<div>Macro not found</div>"}).show()}})}),require(["jquery","pat-base","mockup-patterns-modal"],function(e,r,t){"use strict";return r.extend({name:"plominomacropopup",parser:"mockup",trigger:".plomino-macro",defaults:{},init:function(){var r=this;e(".plominoClose",r.$modal).each(function(){this.removeAttribute("onclick")}),e("#validation_errors a").each(function(){e(this).replaceWith(function(){return e("<span>"+e(this).html()+"</span>")})}),r.render()},render:function(){e(".plominoClose",this.$modal).off("click").on("click",function(r){r.stopPropagation(),r.preventDefault(),e(r.target).trigger("destroy.plone-modal.patterns")})}})}),define("/Users/ivan/code/work/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/macros.js",function(){}),require(["jquery","pat-base"],function(e,r,t){"use strict";return r.extend({name:"plominorefresh",parser:"mockup",trigger:"body.template-edit.portaltype-plominofield",defaults:{},init:function(){var r=this;e("#form-widgets-field_type").change(function(e){r.refresh(e)})},refresh:function(r){var t=e("<input>").attr("type","hidden").attr("name","update.field.type").val("1");e("form#form").append(e(t)),e("form#form").submit()}})}),define("/Users/ivan/code/work/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/refresh.js",function(){});
//# sourceMappingURL=plomino-compiled.js.map