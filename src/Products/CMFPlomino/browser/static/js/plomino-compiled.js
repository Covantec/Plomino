require(["jquery","pat-base","mockup-patterns-texteditor"],function(a,b,c){"use strict";var d=b.extend({name:"plominoformula",parser:"mockup",trigger:".plomino-formula",defaults:{},init:function(){var b=this;b.$el.width();b.$el.hide();var d=a("<pre></pre>");d.appendTo(b.$el.parent()),b.ace=new c(d),b.ace.init(),setTimeout(function(){b.ace.editor.getSession().setMode("ace/mode/python"),d.css("width","100%"),b.ace.editor.resize(),b.ace.setText(b.$el.val()),b.ace.editor.on("change",function(){b.$el.val(b.ace.editor.getValue())})},200)}});return d}),define("/Users/dylanjay/Projects/collective/Plomino2/src/Products/CMFPlomino/browser/static/js/formula.js",function(){}),require(["jquery","pat-base"],function(a,b){"use strict";var c=b.extend({name:"plominotable",parser:"mockup",trigger:".plomino-table",defaults:{},init:function(){var a=this;a.init_search(),a.init_sorting(),a.refresh({}),a.params={}},refresh:function(){var b=this;if(b.options.source){b.$el.find("tr:not(.header-row)").remove();var c=b.$el.find("tr.header-row.count");c.find("td").text("Loading..."),a.get(b.options.source,b.params,function(a){for(var d="",e=0;e<a.rows.length;e++){var f=a.rows[e];if(d+='<tr><td><a href="'+b.options.source+"/../../document/"+f[0]+'">'+f[1]+"</a></td>",f.length>2)for(var g=2;g<f.length;g++)d+="<td>"+f[g]+"</td>";d+="</tr>"}a.rows.length>1?c.find("td").text(a.rows.length+" documents"):c.find("td").text(a.rows.length+" document"),c.before(d)})}},init_search:function(){var b=this,c=a('<form id="plomino-search"><input type="text" placeholder="Search"/></form>');b.$el.before(c),c.on("submit",function(){return!1});var d,e=!1;c.on("keyup",function(){var c=a("#plomino-search input").val();c.length<3&&!e||(d&&clearTimeout(d),d=setTimeout(function(){b.params.search=c,b.refresh(),e=!!c,clearTimeout(d)},1e3))})},init_sorting:function(){var b=this;b.$el.find("th").on("click",function(){b.$el.find("th").removeClass("icon-down-dir icon-up-dir");var c=a(this).attr("data-column");c==b.params.sorton?b.params.reverse=1==b.params.reverse?0:1:(b.params.sorton=c,b.params.reverse=0),0===b.params.reverse?a(this).addClass("icon-down-dir"):a(this).addClass("icon-up-dir"),b.refresh()})}});return c}),define("/Users/dylanjay/Projects/collective/Plomino2/src/Products/CMFPlomino/browser/static/js/table.js",function(){}),require(["jquery","pat-base"],function(a,b){"use strict";var c=b.extend({name:"plominodynamic",parser:"mockup",trigger:"#plomino_form",defaults:{},init:function(){var a=this;a.refresh(this.$el),this.$el.find(":input").change(function(b){a.refresh(b.target)})},refresh:function(b){var c=this,d=c.getCurrentInputs();c.options.docid&&(d._docid=c.options.docid),d._hidewhens=c.getHidewhens(),d._fields=c.getDynamicFields(),d._validation=b.id,(d._hidewhens.length>0||d._fields.length>0)&&a.post(c.options.url+"/dynamic_evaluation",d,function(a){c.applyHidewhens(a.hidewhens),c.applyDynamicFields(a.fields)},"json")},getCurrentInputs:function(){var b={},c=a("form").serialize().split("&");for(var d in c){var e=c[d].split("="),f=decodeURIComponent(e[1].replace(/\+/g,"%20"));b[e[0]]=f}return b},getHidewhens:function(){var b=this,c=[];return b.$el.find(".plomino-hidewhen").each(function(b,d){c.push(a(d).attr("data-hidewhen"))}),c},getDynamicFields:function(){var b=this,c=[];return b.$el.find(".dynamicfield").each(function(b,d){c.push(a(d).attr("data-dynamicfield"))}),c},applyHidewhens:function(a){for(var b=this,c=0;c<a.length;c++){var d=a[c][0],e=a[c][1],f=b.$el.find('.plomino-hidewhen[data-hidewhen="'+d+'"]');e?f.hide():f.show()}},applyDynamicFields:function(a){for(var b=this,c=0;c<a.length;c++){var d=a[c][0],e=a[c][1],f=b.$el.find('.dynamicfield[data-dynamicfield="'+d+'"]');f.text(e)}}});return c}),define("/Users/dylanjay/Projects/collective/Plomino2/src/Products/CMFPlomino/browser/static/js/dynamic.js",function(){}),require(["jquery","pat-base","mockup-patterns-modal","mockup-patterns-select2"],function(a,b,c,d){"use strict";var e=b.extend({name:"plominodatagrid",parser:"mockup",trigger:".plomino-datagrid",defaults:{},init:function(){var a=this;a.fields=a.$el.attr("data-fields").split(","),a.columns=a.$el.attr("data-columns").split(","),a.input=a.$el.find('input[type="hidden"]'),a.values=JSON.parse(a.input.val()),a.rows=JSON.parse(a.$el.find("table").attr("data-rows")),a.col_number=a.fields.length,a.$el.attr("data-form-urls")?a.form_urls=JSON.parse(a.$el.attr("data-form-urls")):a.form_urls=[{url:a.$el.attr("data-form-url")}],a.render()},render:function(){for(var b=this,d=b.$el.find("table"),e="<tr><th></th>",f=0;f<b.col_number;f++)e+="<th>"+b.columns[f]+"</th>";e+="</tr>";for(var g=0;g<b.rows.length;g++){for(var h=b.form_url,i=b.values[g].Form,j=0;j<b.form_urls.length;j++)if(b.form_urls[j].id==i){h=b.form_urls[j].url;break}h+="&"+a.param(b.values[g]),e+='<tr><td class="actions"><a class="edit-row" href="'+h+'" data-formid="'+i+'"><i class="icon-pencil"></i></a>',e+='<a class="remove-row" href="#"><i class="icon-cancel"></i></a>',e+='<a class="up-row" href="#"><i class="icon-up-dir"></i></a>',e+='<a class="down-row" href="#"><i class="icon-down-dir"></i></a></td>';for(var f=0;f<b.col_number;f++){var k=b.rows[g][f]?b.rows[g][f]:"";e+="<td>"+k+"</td>"}e+="</tr>"}var l="";if(b.form_urls.length>1){for(l='<select class="form_select" data-pat="width:10em">',f=0;f<b.form_urls.length;f++){var m=b.form_urls[f];l+='<option value="'+m.url+'">'+m.title+"</option>"}l+="</select>"}void 0!=b.form_urls[0]&&(e+='<tr><td class="actions" colspan="5">'+l+'<a class="add-row" href="'+b.form_urls[0].url+'" data-formid="'+b.form_urls[0].id+'"><i class="icon-plus"></i></a></td></tr>'),d.html(e);var n=b.$el.find(".add-row");b.$el.find(".form_select").each(function(c,d){var e;a(d).change(function(){for(var c=a(d).val(),f=0;f<b.form_urls.length;f++)if(b.form_urls[f].url==c){e=b.form_urls[f].id;break}n.attr("href",c).attr("data-formid",e)})}),n.click(function(a){a.stopPropagation(),a.preventDefault();var d=b.$el.find(".add-row i");(function(a){new c(d,{ajaxUrl:n.attr("href"),ajaxType:"POST",position:"middle top",actions:{"input.plominoSave":{onSuccess:b.add.bind({grid:b,formid:n.attr("data-formid")}),onError:function(){return a.alert(response.responseJSON.errors.join("\n")),!1}}}}).show()})(window.top)}),b.$el.find(".edit-row").each(function(d,e){var f=a(e).attr("href").split("?",2);a(e).on("click",function(g){g.preventDefault(),jQuery.ajax({url:f[0],type:"POST",data:f[1]}).done(function(f){new c(b.$el,{html:f,position:"middle top",actions:{"input.plominoSave":{onSuccess:b.edit.bind({grid:b,row:d,formid:a(e).attr("data-formid")}),onError:function(){return window.alert(response.responseJSON.errors.join("\n")),!1}}}}).show()})})}),b.$el.find(".remove-row").each(function(c,d){a(d).click(function(){b.remove(b,c)})}),b.$el.find(".up-row").each(function(c,d){a(d).click(function(){b.up(b,c)})}),b.$el.find(".down-row").each(function(c,d){a(d).click(function(){b.down(b,c)})})},add:function(a,b,c,d,e){var f=this.grid,g=this.formid;if(!b.errors){a.hide();for(var h={},i=[],j=(e.serializeArray(),0);j<f.col_number;j++)void 0!=f.fields[j]&&f.fields[j]in b?i.push(b[f.fields[j]].rendered):i.push("");for(var k in b)h[k]=b[k].raw;h.Form=g,f.values.push(h),f.input.val(JSON.stringify(f.values)),f.rows.push(i),f.render()}return!1},edit:function(a,b,c,d,e){var f=this.grid,g=this.row,h=this.formid;if(!b.errors){a.hide();for(var i=[],j=0;j<f.col_number;j++)void 0!=f.fields[j]&&f.fields[j]in b?i.push(b[f.fields[j]].rendered):i.push("");f.values[g].Form=h;for(var k in b)f.values[g][k]=b[k].raw;f.input.val(JSON.stringify(f.values)),f.rows[g]=i,f.render()}return!1},remove:function(a,b){return a.values.splice(b,1),a.input.val(JSON.stringify(a.values)),a.rows.splice(b,1),a.render(),!1},up:function(a,b){if(0!=b)return a.values.splice(b-1,0,a.values.splice(b,1)[0]),a.input.val(JSON.stringify(a.values)),a.rows.splice(b-1,0,a.rows.splice(b,1)[0]),a.render(),!1},down:function(a,b){if(b!=a.values.length-1)return a.values.splice(b,0,a.values.splice(b+1,1)[0]),a.input.val(JSON.stringify(a.values)),a.rows.splice(b,0,a.rows.splice(b+1,1)[0]),a.render(),!1}});return e}),define("/Users/dylanjay/Projects/collective/Plomino2/src/Products/CMFPlomino/browser/static/js/datagrid.js",function(){}),require(["jquery","pat-base"],function(a,b){"use strict";var c=b.extend({name:"plominomultipage",parser:"mockup",trigger:'body.template-page.portaltype-plominoform #plomino_form input[name="plomino_current_page"]',defaults:{},init:function(){var a=this.$el.parents("#plomino_form").attr("action"),b={multipage:"multipage"};history.pushState(b,"",a)}});return c}),define("/Users/dylanjay/Projects/collective/Plomino2/src/Products/CMFPlomino/browser/static/js/multipage.js",function(){}),require(["jquery","pat-base","mockup-patterns-modal","mockup-patterns-select2","mockup-patterns-sortable","mockup-patterns-backdrop","mockup-utils","pat-registry"],function(a,b,c,d,e,f,g,h){"use strict";var i=b.extend({name:"plominomacros",parser:"mockup",trigger:".plomino-macros",defaults:{},init:function(){var a=this;a.form_urls=JSON.parse(a.$el.attr("data-form-urls"));var b=[];for(var c in a.form_urls)b.push({text:c,children:a.form_urls[c].map(function(a){if(void 0!=a.title)return{id:a.id,text:a.title}})});a.select2_args={data:b,separator:"\t",multiple:!0,allowNewItems:!1,placeholder:"add a new rule",formatSelection:a.formatMacro};var d="";a.item=a.$el.find("li").last()[0].outerHTML,a.$el.prepend(d),a.ids={};var e=0;a.$el.find("input").each(function(b,c){var d=[];""!=c.value&&(d=c.value.split("\t")),void 0==d.map&&(d=[d]),d=d.map(function(b){if(""!=b){var c=JSON.parse(b);return c._macro_id_&&(a.ids[c._macro_id_]=!0),{id:b,text:""}}}),a.initInput.bind({widget:a})(c,d),e++}),a.cleanup_inputs.bind({widget:a})(),a.backdrop=new f(a.$el,{closeOnEsc:!0,closeOnClick:!1}),a.loading=g.Loading({backdrop:a.backdrop})},initInput:function(b,c){var e=this.widget;new d(a(b),e.select2_args);var f=a(b);f.select2("data",c),f.change(function(b){var c=a(b.target);if(void 0!=b.added){var d=b.added.id,f=b.added.text,g=c.select2("data");g.pop(),c.select2("data",g),e.edit_macro.bind({widget:e})(c,d,f,{},g.length)}else if(void 0!=b.removed){b.removed.id;e.cleanup_inputs.bind({widget:e})()}return!1})},cleanup_inputs:function(){var b=this.widget,c=b.$el.find(".select2-container").size();b.$el.find(".select2-container").each(function(d,f){var g=a(f),h=g.select2("data");if(0==h.length&&d<c-1?a(f).closest("li").remove():(a(f).find(".select2-search-choice").each(function(c,d){a(d).on("click",function(a){a.preventDefault();var d=h[c],e=JSON.parse(d.id),f=e.Form;b.edit_macro.bind({widget:b})(g,f,e.title,e,c)})}),new e(a(f).find(".select2-choices"),{selector:".select2-search-choice",drop:function(){a(f).select2("onSortEnd")}})),d==c-1&&h.length>0){var i=a(b.item).appendTo(b.$el);i.find("input").each(function(c,d){b.initInput.bind({widget:b})(a(d),[])})}}),new e(b.$el,{selector:".plomino-macros-rule"})},formatMacro:function(a){if(a.text)return a.text;var a=JSON.parse(a.id),b=a.Form;if("or"==b||"and"==b||"nor"==b)return a.title;var c="do";return b.startsWith("macro_condition_")&&(c="if"),'<span class="plomino_edit_macro"><i>'+c+"</i>&nbsp;"+a.title+'<i class="icon-pencil"></i></span>'},edit_macro:function(b,d,e,f,g){var h=this.widget,i=null;for(var j in h.form_urls)h.form_urls[j].map(function(a){a.id==d&&(i=a.url)});if("#"!=i[0]){if(null==i)return void new c(a(b),{title:"Macro not found",html:"<div>Macro not found</div>"}).show();for(var k=f._macro_id_,l=1;void 0==k||h.ids[k];)k=d+"_"+l,l++;if(f._macro_id_=k,h.ids[k]=!0,i.startsWith("#")){var m=b.select2("data");return f.title=e,f.Form=d,m.push({id:JSON.stringify(f),text:e}),b.select2("data",m),void h.cleanup_inputs.bind({widget:h})()}h.backdrop.show(),h.loading.show(!0),jQuery.ajax({url:i,type:"POST",data:f}).done(function(f){h.loading.hide(),h.backdrop.hide();new c(h.$el,{html:f,position:"middle top",actions:{"input.plominoSave":{onSuccess:function(c,f,i,j,k){if(a(f).find("#validation_errors").length>0)return!1;if(f.errors)return!1;c.hide();var l=b.select2("data"),m={};return a.map(f,function(a,b){m[b]=a.raw}),m.Form=d,void 0==m.title&&(m.title=e),l[g]={id:JSON.stringify(m),text:""},b.select2("data",l),h.cleanup_inputs.bind({widget:h})(),!1},onError:function(){return window.alert(response.responseJSON.errors.join("\n")),!1}}}}).show()})}}});return i}),require(["jquery","pat-base","mockup-patterns-modal"],function(a,b,c){"use strict";var d=b.extend({name:"plominomacropopup",parser:"mockup",trigger:".plomino-macro",defaults:{},init:function(){var b=this;a(".plominoClose",b.$modal).each(function(){this.removeAttribute("onclick")}),a("#validation_errors a").each(function(){a(this).replaceWith(function(){return a("<span>"+a(this).html()+"</span>")})}),b.render()},render:function(){var b=this;a(".plominoClose",b.$modal).off("click").on("click",function(b){b.stopPropagation(),b.preventDefault(),a(b.target).trigger("destroy.plone-modal.patterns")})}});return d}),define("/Users/dylanjay/Projects/collective/Plomino2/src/Products/CMFPlomino/browser/static/js/macros.js",function(){}),require(["jquery","pat-base"],function(a,b,c){"use strict";var d=b.extend({name:"plominorefresh",parser:"mockup",trigger:"body.template-edit.portaltype-plominofield",defaults:{},init:function(){var b=this;a("#form-widgets-field_type").change(function(a){b.refresh(a)})},refresh:function(b){var c=a("<input>").attr("type","hidden").attr("name","update.field.type").val("1");a("form#form").append(a(c)),a("form#form").submit()}});return d}),define("/Users/dylanjay/Projects/collective/Plomino2/src/Products/CMFPlomino/browser/static/js/refresh.js",function(){});
//# sourceMappingURL=plomino-compiled.js.map